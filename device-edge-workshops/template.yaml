image: {{ image }}
numcpus: {{ numcpus }}
cpumodel: host-passthrough
memory: {{ memory }}
{% if rhnregister %}
rhnregister: true
{% endif %}
{% if rhnorg %}
rhnorg: {{ rhnorg }}
{% endif %}
{% if rhnactivationkey %}
rhnactivationkey: {{ rhnactivationkey }}
{% endif %}
nets:
  - name: {{ net_name }}
reservedns: {{ reservedns }}
disks:
  - size: {{ disk_size }}
cmds:
  - echo {{ user_password }} | passwd --stdin root
  - useradd {{ user }}
  - usermod -aG wheel {{ user }}
  - echo "{{ user }} ALL=(root) NOPASSWD:ALL" | tee -a /etc/sudoers.d/{{ user }}
  - echo {{ user_password }} | passwd --stdin {{ user }}
  - subscription-manager refresh
  - subscription-manager attach --auto
  - sudo dnf update -y
  - dnf install git vim unzip wget tar python3 python3-pip util-linux-user tmux bind-utils firewalld cockpit -y
  - systemctl start  firewalld && systemctl enable firewalld
  - systemctl enable --now cockpit.socket && firewall-cmd --permanent --add-service=cockpit && firewall-cmd --reload
  - cd /root/ && git clone https://github.com/jjaswanson4/device-edge-workshops.git
files:
  - path: /root/local-inventory.yml
    origin: ~/.generated/vmfiles/local-inventory.yml
  - path: /home/{{ user }}/local-inventory.yml
    origin:  ~/.generated/vmfiles/local-inventory.yml